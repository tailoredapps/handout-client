'use strict'

import chalk from 'chalk'
import stripAnsi from 'strip-ansi'
import {
  MSG_LEVEL_DEBUG,
  MSG_LEVEL_ERROR,
  MSG_LEVEL_INFO,
  MSG_LEVEL_OK,
  MSG_LEVEL_RAW
} from 'handout-constants'

export const outputStyles = {
  headline: chalk.bold.yellow,
  url: chalk.yellow,
  target: chalk.cyan,
  error: chalk.bold.red,
  username: chalk.yellow,
  app: chalk.yellow,
  usage: chalk.bold.yellow,
  cliArg: chalk.cyan,
  [MSG_LEVEL_ERROR]: chalk.bold.red,
  [MSG_LEVEL_INFO]: chalk.bold.grey,
  [MSG_LEVEL_OK]: chalk.bold.green,
  [MSG_LEVEL_DEBUG]: chalk.bgYellow
}

function pad (str, max = 15, char = ' ') {
  const len = stripAnsi(str).length

  return len < max ? str + (new Array(max - len + 1)).join(char) : str
}

export default function output (message, level = MSG_LEVEL_INFO, fromRemote = false) {
  let prepend = ''

  if (level !== MSG_LEVEL_RAW) {
    prepend += `[${fromRemote ? 'server' : 'local'}:${outputStyles[ level ](level)}]`

    console.log(`${pad(prepend)} ${message}`)
  } else {
    console.log(message)
  }
}

export function outputTitle ({ version }) { // All of package.json passed in, using only version for now
  const hr = chalk.grey(new Array(80).join('-'))
  const newline = ''
  const o = msg => output(msg, MSG_LEVEL_RAW)

  o(newline)
  o(hr)
  o(outputStyles.headline('handout'))
  o(`${outputStyles.headline('tailored apps')} backend deployment tool v${version}`)
  o(hr)
  o(newline)
}
