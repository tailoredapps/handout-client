'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.outputStyles = undefined;

var _outputStyles;

exports.default = output;
exports.outputTitle = outputTitle;
exports.processResponse = processResponse;

var _chalk = require('chalk');

var _chalk2 = _interopRequireDefault(_chalk);

var _stripAnsi = require('strip-ansi');

var _stripAnsi2 = _interopRequireDefault(_stripAnsi);

var _handoutConstants = require('handout-constants');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

var outputStyles = exports.outputStyles = (_outputStyles = {
  headline: _chalk2.default.bold.yellow,
  url: _chalk2.default.yellow,
  target: _chalk2.default.cyan,
  error: _chalk2.default.bold.red,
  username: _chalk2.default.yellow,
  app: _chalk2.default.yellow,
  usage: _chalk2.default.bold.yellow,
  cliArg: _chalk2.default.cyan
}, _defineProperty(_outputStyles, _handoutConstants.MSG_LEVEL_ERROR, _chalk2.default.bold.red), _defineProperty(_outputStyles, _handoutConstants.MSG_LEVEL_INFO, _chalk2.default.bold.grey), _defineProperty(_outputStyles, _handoutConstants.MSG_LEVEL_OK, _chalk2.default.bold.green), _defineProperty(_outputStyles, _handoutConstants.MSG_LEVEL_DEBUG, _chalk2.default.bgYellow), _outputStyles);

// Utility stuff
var raw = function raw(msg) {
  return output(msg, _handoutConstants.MSG_LEVEL_RAW);
};
var newline = function newline() {
  return raw('');
};
var hr = function hr() {
  return raw(_chalk2.default.grey(new Array(80).join('-')));
};

function pad(str) {
  var max = arguments.length <= 1 || arguments[1] === undefined ? 15 : arguments[1];
  var char = arguments.length <= 2 || arguments[2] === undefined ? ' ' : arguments[2];

  var len = (0, _stripAnsi2.default)(str).length;

  return len < max ? str + new Array(max - len + 1).join(char) : str;
}

function output(message) {
  var level = arguments.length <= 1 || arguments[1] === undefined ? _handoutConstants.MSG_LEVEL_INFO : arguments[1];
  var fromRemote = arguments.length <= 2 || arguments[2] === undefined ? false : arguments[2];

  var prepend = '';

  if (level !== _handoutConstants.MSG_LEVEL_RAW) {
    prepend += '[' + (fromRemote ? 'server' : 'local') + ':' + outputStyles[level](level) + ']';

    console.log(pad(prepend) + ' ' + message);
  } else {
    console.log(message);
  }
}

function outputTitle(_ref) {
  var version = _ref.version;
  // All of package.json passed in, using only version for now
  newline();
  hr();
  raw(outputStyles.headline('handout'));
  raw(outputStyles.headline('tailored apps') + ' backend deployment tool v' + version);
  hr();
  newline();
}

/**
 * Processes raw data and generates output for server responses that require additional processing (i.e. those with MSG_LEVEL_PROCESS).
 *
 * @param wrapperObj object
 */
function processResponse(_ref2) {
  var category = _ref2.category;
  var data = _ref2.data;

  // We only implement CATEGORY_INFO for now, can use a switch or a function map later
  if (category === _handoutConstants.CATEGORY_INFO) {
    processInfoResponse(data);
  } else {
    output('Incorrect output processing category "' + category + '" returned from server.', _handoutConstants.MSG_LEVEL_ERROR);
  }
}

function processInfoResponse(_ref3) {
  var hosts = _ref3.hosts;
  var deployment = _ref3.deployment;
  var users = _ref3.users;
  var permissions = _ref3.permissions;
  var headline = outputStyles.headline;
  var target = outputStyles.target;

  var item = _chalk2.default.blue;
  var granted = _chalk2.default.green;
  var denied = _chalk2.default.red;

  var indent = function indent(str) {
    return raw('    ' + str);
  };
  var col = function col(left, right) {
    var width = arguments.length <= 2 || arguments[2] === undefined ? 25 : arguments[2];
    return indent('' + pad(left, width) + right);
  };
  var title = function title(str) {
    hr();
    indent(headline(str.toUpperCase()));
    hr();
  };

  if (users) {
    title('Users');
    users.forEach(function (u) {
      return col(item(u));
    });
  }

  title('Permissions');
  Object.keys(permissions).forEach(function (p) {
    col(item(p), permissions[p] ? granted('granted') : denied('denied'));
  });

  title('Hosts');
  Object.keys(hosts).forEach(function (hostId) {
    var host = hosts[hostId];
    var isGroup = Array.isArray(host);
    var idOutput = (isGroup ? 'group: ' : '') + item(hostId);

    col(idOutput, isGroup ? host.join(', ') : host);
  });

  title('Deployment');
  Object.keys(deployment).forEach(function (appId) {
    var perm = deployment[appId];

    col(item(appId), Array.isArray(perm) ? perm.map(function (p) {
      return target(p);
    }).join(', ') : perm ? granted('all targets') : denied('denied'));
  });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9ub2RlX21vZHVsZXMvb3V0cHV0LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7a0JBdUN3QjtRQVlSO1FBY0E7Ozs7Ozs7Ozs7Ozs7Ozs7QUFwRFQsSUFBTTtBQUNYLFlBQVUsZ0JBQU0sSUFBTixDQUFXLE1BQVg7QUFDVixPQUFLLGdCQUFNLE1BQU47QUFDTCxVQUFRLGdCQUFNLElBQU47QUFDUixTQUFPLGdCQUFNLElBQU4sQ0FBVyxHQUFYO0FBQ1AsWUFBVSxnQkFBTSxNQUFOO0FBQ1YsT0FBSyxnQkFBTSxNQUFOO0FBQ0wsU0FBTyxnQkFBTSxJQUFOLENBQVcsTUFBWDtBQUNQLFVBQVEsZ0JBQU0sSUFBTjtxRUFDVyxnQkFBTSxJQUFOLENBQVcsR0FBWCxvRUFDRCxnQkFBTSxJQUFOLENBQVcsSUFBWCxrRUFDRixnQkFBTSxJQUFOLENBQVcsS0FBWCxxRUFDRyxnQkFBTSxRQUFOLGlCQVpSOzs7QUFnQmIsSUFBTSxNQUFNLFNBQU4sR0FBTTtTQUFPLE9BQU8sR0FBUDtDQUFQO0FBQ1osSUFBTSxVQUFVLFNBQVYsT0FBVTtTQUFNLElBQUksRUFBSjtDQUFOO0FBQ2hCLElBQU0sS0FBSyxTQUFMLEVBQUs7U0FBTSxJQUFJLGdCQUFNLElBQU4sQ0FBVyxJQUFJLEtBQUosQ0FBVSxFQUFWLEVBQWMsSUFBZCxDQUFtQixHQUFuQixDQUFYLENBQUo7Q0FBTjs7QUFFWCxTQUFTLEdBQVQsQ0FBYyxHQUFkLEVBQXlDO01BQXRCLDREQUFNLGtCQUFnQjtNQUFaLDZEQUFPLG1CQUFLOztBQUN2QyxNQUFNLE1BQU0seUJBQVUsR0FBVixFQUFlLE1BQWYsQ0FEMkI7O0FBR3ZDLFNBQU8sTUFBTSxHQUFOLEdBQVksTUFBTSxJQUFLLEtBQUosQ0FBVSxNQUFNLEdBQU4sR0FBWSxDQUFaLENBQVgsQ0FBMkIsSUFBM0IsQ0FBZ0MsSUFBaEMsQ0FBTixHQUE4QyxHQUExRCxDQUhnQztDQUF6Qzs7QUFNZSxTQUFTLE1BQVQsQ0FB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QUFTO0FBQ3ZDLFFBQU0sT0FBTyxXQUFXLEtBQVgsQ0FBUCxDQURpQzs7QUFHdkMsUUFBSSxLQUFLLEtBQUwsQ0FBSixFQUFpQixNQUFNLE9BQU4sQ0FBYyxJQUFkLElBQ2IsS0FBSyxHQUFMLENBQVM7YUFBSyxPQUFPLENBQVA7S0FBTCxDQUFULENBQXlCLElBQXpCLENBQThCLElBQTlCLENBRGEsR0FFWixPQUFPLFFBQVEsYUFBUixDQUFQLEdBQWdDLE9BQU8sUUFBUCxDQUFoQyxDQUZMLENBSHVDO0dBQVQsQ0FBaEMsQ0FuQ3VFO0NBQXpFIiwiZmlsZSI6Im91dHB1dC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0J1xuXG5pbXBvcnQgY2hhbGsgZnJvbSAnY2hhbGsnXG5pbXBvcnQgc3RyaXBBbnNpIGZyb20gJ3N0cmlwLWFuc2knXG5pbXBvcnQge1xuICBDQVRFR09SWV9JTkZPLFxuICBNU0dfTEVWRUxfREVCVUcsXG4gIE1TR19MRVZFTF9FUlJPUixcbiAgTVNHX0xFVkVMX0lORk8sXG4gIE1TR19MRVZFTF9PSyxcbiAgTVNHX0xFVkVMX1JBV1xufSBmcm9tICdoYW5kb3V0LWNvbnN0YW50cydcblxuZXhwb3J0IGNvbnN0IG91dHB1dFN0eWxlcyA9IHtcbiAgaGVhZGxpbmU6IGNoYWxrLmJvbGQueWVsbG93LFxuICB1cmw6IGNoYWxrLnllbGxvdyxcbiAgdGFyZ2V0OiBjaGFsay5jeWFuLFxuICBlcnJvcjogY2hhbGsuYm9sZC5yZWQsXG4gIHVzZXJuYW1lOiBjaGFsay55ZWxsb3csXG4gIGFwcDogY2hhbGsueWVsbG93LFxuICB1c2FnZTogY2hhbGsuYm9sZC55ZWxsb3csXG4gIGNsaUFyZzogY2hhbGsuY3lhbixcbiAgW01TR19MRVZFTF9FUlJPUl06IGNoYWxrLmJvbGQucmVkLFxuICBbTVNHX0xFVkVMX0lORk9dOiBjaGFsay5ib2xkLmdyZXksXG4gIFtNU0dfTEVWRUxfT0tdOiBjaGFsay5ib2xkLmdyZWVuLFxuICBbTVNHX0xFVkVMX0RFQlVHXTogY2hhbGsuYmdZZWxsb3dcbn1cblxuLy8gVXRpbGl0eSBzdHVmZlxuY29uc3QgcmF3ID0gbXNnID0+IG91dHB1dChtc2csIE1TR19MRVZFTF9SQVcpXG5jb25zdCBuZXdsaW5lID0gKCkgPT4gcmF3KCcnKVxuY29uc3QgaHIgPSAoKSA9PiByYXcoY2hhbGsuZ3JleShuZXcgQXJyYXkoODApLmpvaW4oJy0nKSkpXG5cbmZ1bmN0aW9uIHBhZCAoc3RyLCBtYXggPSAxNSwgY2hhciA9ICcgJykge1xuICBjb25zdCBsZW4gPSBzdHJpcEFuc2koc3RyKS5sZW5ndGhcblxuICByZXR1cm4gbGVuIDwgbWF4ID8gc3RyICsgKG5ldyBBcnJheShtYXggLSBsZW4gKyAxKSkuam9pbihjaGFyKSA6IHN0clxufVxuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBvdXRwdXQgKG1lc3NhZ2UsIGxldmVsID0gTVNHX0xFVkVMX0lORk8sIGZyb21SZW1vdGUgPSBmYWxzZSkge1xuICBsZXQgcHJlcGVuZCA9ICcnXG5cbiAgaWYgKGxldmVsICE9PSBNU0dfTEVWRUxfUkFXKSB7XG4gICAgcHJlcGVuZCArPSBgWyR7ZnJvbVJlbW90ZSA/ICdzZXJ2ZXInIDogJ2xvY2FsJ306JHtvdXRwdXRTdHlsZXNbIGxldmVsIF0obGV2ZWwpfV1gXG5cbiAgICBjb25zb2xlLmxvZyhgJHtwYWQocHJlcGVuZCl9ICR7bWVzc2FnZX1gKVxuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUubG9nKG1lc3NhZ2UpXG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG91dHB1dFRpdGxlICh7IHZlcnNpb24gfSkgeyAvLyBBbGwgb2YgcGFja2FnZS5qc29uIHBhc3NlZCBpbiwgdXNpbmcgb25seSB2ZXJzaW9uIGZvciBub3dcbiAgbmV3bGluZSgpXG4gIGhyKClcbiAgcmF3KG91dHB1dFN0eWxlcy5oZWFkbGluZSgnaGFuZG91dCcpKVxuICByYXcoYCR7b3V0cHV0U3R5bGVzLmhlYWRsaW5lKCd0YWlsb3JlZCBhcHBzJyl9IGJhY2tlbmQgZGVwbG95bWVudCB0b29sIHYke3ZlcnNpb259YClcbiAgaHIoKVxuICBuZXdsaW5lKClcbn1cblxuLyoqXG4gKiBQcm9jZXNzZXMgcmF3IGRhdGEgYW5kIGdlbmVyYXRlcyBvdXRwdXQgZm9yIHNlcnZlciByZXNwb25zZXMgdGhhdCByZXF1aXJlIGFkZGl0aW9uYWwgcHJvY2Vzc2luZyAoaS5lLiB0aG9zZSB3aXRoIE1TR19MRVZFTF9QUk9DRVNTKS5cbiAqXG4gKiBAcGFyYW0gd3JhcHBlck9iaiBvYmplY3RcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHByb2Nlc3NSZXNwb25zZSAoeyBjYXRlZ29yeSwgZGF0YSB9KSB7XG4gIC8vIFdlIG9ubHkgaW1wbGVtZW50IENBVEVHT1JZX0lORk8gZm9yIG5vdywgY2FuIHVzZSBhIHN3aXRjaCBvciBhIGZ1bmN0aW9uIG1hcCBsYXRlclxuICBpZiAoY2F0ZWdvcnkgPT09IENBVEVHT1JZX0lORk8pIHtcbiAgICBwcm9jZXNzSW5mb1Jlc3BvbnNlKGRhdGEpXG4gIH0gZWxzZSB7XG4gICAgb3V0cHV0KGBJbmNvcnJlY3Qgb3V0cHV0IHByb2Nlc3NpbmcgY2F0ZWdvcnkgXCIke2NhdGVnb3J5fVwiIHJldHVybmVkIGZyb20gc2VydmVyLmAsIE1TR19MRVZFTF9FUlJPUilcbiAgfVxufVxuXG5mdW5jdGlvbiBwcm9jZXNzSW5mb1Jlc3BvbnNlICh7IGhvc3RzLCBkZXBsb3ltZW50LCB1c2VycywgcGVybWlzc2lvbnMgfSkge1xuICBjb25zdCB7IGhlYWRsaW5lLCB0YXJnZXQgfSA9IG91dHB1dFN0eWxlc1xuXG4gIGNvbnN0IGl0ZW0gPSBjaGFsay5ibHVlXG4gIGNvbnN0IGdyYW50ZWQgPSBjaGFsay5ncmVlblxuICBjb25zdCBkZW5pZWQgPSBjaGFsay5yZWRcblxuICBjb25zdCBpbmRlbnQgPSAoc3RyKSA9PiByYXcoYCAgICAke3N0cn1gKVxuICBjb25zdCBjb2wgPSAobGVmdCwgcmlnaHQsIHdpZHRoID0gMjUpID0+IGluZGVudChgJHtwYWQobGVmdCwgd2lkdGgpfSR7cmlnaHR9YClcbiAgY29uc3QgdGl0bGUgPSBzdHIgPT4ge1xuICAgIGhyKClcbiAgICBpbmRlbnQoaGVhZGxpbmUoc3RyLnRvVXBwZXJDYXNlKCkpKVxuICAgIGhyKClcbiAgfVxuXG4gIGlmICh1c2Vycykge1xuICAgIHRpdGxlKCdVc2VycycpXG4gICAgdXNlcnMuZm9yRWFjaCh1ID0+IGNvbChpdGVtKHUpKSlcbiAgfVxuXG4gIHRpdGxlKCdQZXJtaXNzaW9ucycpXG4gIE9iamVjdC5rZXlzKHBlcm1pc3Npb25zKS5mb3JFYWNoKHAgPT4ge1xuICAgIGNvbChpdGVtKHApLCBwZXJtaXNzaW9uc1twXSA/IGdyYW50ZWQoJ2dyYW50ZWQnKSA6IGRlbmllZCgnZGVuaWVkJykpXG4gIH0pXG5cbiAgdGl0bGUoJ0hvc3RzJylcbiAgT2JqZWN0LmtleXMoaG9zdHMpLmZvckVhY2goaG9zdElkID0+IHtcbiAgICBjb25zdCBob3N0ID0gaG9zdHNbaG9zdElkXVxuICAgIGNvbnN0IGlzR3JvdXAgPSBBcnJheS5pc0FycmF5KGhvc3QpXG4gICAgY29uc3QgaWRPdXRwdXQgPSAoaXNHcm91cCA/ICdncm91cDogJyA6ICcnKSArIGl0ZW0oaG9zdElkKVxuXG4gICAgY29sKGlkT3V0cHV0LCBpc0dyb3VwID8gaG9zdC5qb2luKCcsICcpIDogaG9zdClcbiAgfSlcblxuICB0aXRsZSgnRGVwbG95bWVudCcpXG4gIE9iamVjdC5rZXlzKGRlcGxveW1lbnQpLmZvckVhY2goYXBwSWQgPT4ge1xuICAgIGNvbnN0IHBlcm0gPSBkZXBsb3ltZW50W2FwcElkXVxuXG4gICAgY29sKGl0ZW0oYXBwSWQpLCBBcnJheS5pc0FycmF5KHBlcm0pXG4gICAgICA/IHBlcm0ubWFwKHAgPT4gdGFyZ2V0KHApKS5qb2luKCcsICcpXG4gICAgICA6IChwZXJtID8gZ3JhbnRlZCgnYWxsIHRhcmdldHMnKSA6IGRlbmllZCgnZGVuaWVkJykpXG4gICAgKVxuICB9KVxufVxuIl19