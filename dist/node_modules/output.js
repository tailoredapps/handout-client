'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.outputStyles = undefined;

var _outputStyles;

exports.default = output;
exports.outputTitle = outputTitle;
exports.processResponse = processResponse;

var _chalk = require('chalk');

var _chalk2 = _interopRequireDefault(_chalk);

var _stripAnsi = require('strip-ansi');

var _stripAnsi2 = _interopRequireDefault(_stripAnsi);

var _handoutConstants = require('handout-constants');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

var outputStyles = exports.outputStyles = (_outputStyles = {
  headline: _chalk2.default.bold.yellow,
  url: _chalk2.default.yellow,
  target: _chalk2.default.cyan,
  error: _chalk2.default.bold.red,
  username: _chalk2.default.yellow,
  app: _chalk2.default.yellow,
  usage: _chalk2.default.bold.yellow,
  cliArg: _chalk2.default.cyan
}, _defineProperty(_outputStyles, _handoutConstants.MSG_LEVEL_ERROR, _chalk2.default.bold.red), _defineProperty(_outputStyles, _handoutConstants.MSG_LEVEL_INFO, _chalk2.default.bold.grey), _defineProperty(_outputStyles, _handoutConstants.MSG_LEVEL_OK, _chalk2.default.bold.green), _defineProperty(_outputStyles, _handoutConstants.MSG_LEVEL_DEBUG, _chalk2.default.bgYellow), _defineProperty(_outputStyles, _handoutConstants.MSG_LEVEL_WARN, _chalk2.default.bgRed), _outputStyles);

// Utility stuff
var raw = function raw(msg) {
  return output(msg, _handoutConstants.MSG_LEVEL_RAW);
};
var newline = function newline() {
  return raw('');
};
var hr = function hr() {
  return raw(_chalk2.default.grey(new Array(80).join('-')));
};

function pad(str) {
  var max = arguments.length <= 1 || arguments[1] === undefined ? 15 : arguments[1];
  var char = arguments.length <= 2 || arguments[2] === undefined ? ' ' : arguments[2];

  var len = (0, _stripAnsi2.default)(str).length;

  return len < max ? str + new Array(max - len + 1).join(char) : str;
}

function output(message) {
  var level = arguments.length <= 1 || arguments[1] === undefined ? _handoutConstants.MSG_LEVEL_INFO : arguments[1];
  var fromRemote = arguments.length <= 2 || arguments[2] === undefined ? false : arguments[2];

  var prepend = '';

  if (level !== _handoutConstants.MSG_LEVEL_RAW) {
    prepend += '[' + (fromRemote ? 'server' : 'local') + ':' + outputStyles[level](level) + ']';

    console.log(pad(prepend) + ' ' + message);
  } else {
    console.log(message);
  }
}

function outputTitle(_ref) {
  var version = _ref.version;
  // All of package.json passed in, using only version for now
  newline();
  hr();
  raw(outputStyles.headline('handout'));
  raw(outputStyles.headline('tailored apps') + ' backend deployment tool v' + version);
  hr();
  newline();
}

/**
 * Processes raw data and generates output for server responses that require additional processing (i.e. those with MSG_LEVEL_PROCESS).
 *
 * @param wrapperObj object
 */
function processResponse(_ref2) {
  var category = _ref2.category;
  var data = _ref2.data;

  // We only implement CATEGORY_INFO for now, can use a switch or a function map later
  if (category === _handoutConstants.CATEGORY_INFO) {
    processInfoResponse(data);
  } else {
    output('Incorrect output processing category "' + category + '" returned from server.', _handoutConstants.MSG_LEVEL_ERROR);
  }
}

function processInfoResponse(_ref3) {
  var hosts = _ref3.hosts;
  var deployment = _ref3.deployment;
  var users = _ref3.users;
  var permissions = _ref3.permissions;
  var headline = outputStyles.headline;

  var item = _chalk2.default.blue;
  var granted = _chalk2.default.green;
  var denied = _chalk2.default.red;

  var indent = function indent(str) {
    return raw('    ' + str);
  };
  var col = function col(left) {
    var right = arguments.length <= 1 || arguments[1] === undefined ? '' : arguments[1];
    var width = arguments.length <= 2 || arguments[2] === undefined ? 25 : arguments[2];
    return indent('' + pad(left, width) + right);
  };
  var title = function title(str) {
    hr();
    indent(headline(str.toUpperCase()));
    hr();
  };

  if (users) {
    title('Users');
    users.forEach(function (u) {
      return col(item(u));
    });
  }

  title('Permissions');
  Object.keys(permissions).forEach(function (p) {
    col(item(p), permissions[p] ? granted('granted') : denied('denied'));
  });

  title('Targets');
  col('TARGET ID', 'HOSTNAME');
  Object.keys(hosts).forEach(function (hostId) {
    var host = hosts[hostId];
    var isGroup = Array.isArray(host);
    var idOutput = (isGroup ? 'group: ' : '') + item(hostId);

    col(idOutput, isGroup ? host.join(', ') : host);
  });

  title('Deployment');
  col('APP', 'TARGETS');
  Object.keys(deployment).forEach(function (appId) {
    var targets = deployment[appId];

    // Each applicable deployment target for the current app will be a property of the "targets" object, and the
    // property's value will be a boolean (true when deployment permission has been granted, false otherwise)
    col(item(appId), Object.keys(targets).map(function (target) {
      return targets[target] ? granted(target) : denied(target);
    }).join(', '));
  });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9ub2RlX21vZHVsZXMvb3V0cHV0LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7a0JBeUN3QjtRQVlSO1FBY0E7Ozs7Ozs7Ozs7Ozs7Ozs7QUFyRFQsSUFBTTtBQUNYLFlBQVUsZ0JBQU0sSUFBTixDQUFXLE1BQVg7QUFDVixPQUFLLGdCQUFNLE1BQU47QUFDTCxVQUFRLGdCQUFNLElBQU47QUFDUixTQUFPLGdCQUFNLElBQU4sQ0FBVyxHQUFYO0FBQ1AsWUFBVSxnQkFBTSxNQUFOO0FBQ1YsT0FBSyxnQkFBTSxNQUFOO0FBQ0wsU0FBTyxnQkFBTSxJQUFOLENBQVcsTUFBWDtBQUNQLFVBQVEsZ0JBQU0sSUFBTjtxRUFDVyxnQkFBTSxJQUFOLENBQVcsR0FBWCxvRUFDRCxnQkFBTSxJQUFOLENBQVcsSUFBWCxrRUFDRixnQkFBTSxJQUFOLENBQVcsS0FBWCxxRUFDRyxnQkFBTSxRQUFOLG9FQUNELGdCQUFNLEtBQU4saUJBYlA7OztBQWlCYixJQUFNLE1BQU0sU0FBTixHQUFNO1NBQU8sT0FBTyxHQUFQO0NBQVA7QUFDWixJQUFNLFVBQVUsU0FBVixPQUFVO1NBQU0sSUFBSSxFQUFKO0NBQU47QUFDaEIsSUFBTSxLQUFLLFNBQUwsRUFBSztTQUFNLElBQUksZ0JBQU0sSUFBTixDQUFXLElBQUksS0FBSixDQUFVLEVBQVYsRUFBYyxJQUFkLENBQW1CLEdBQW5CLENBQVgsQ0FBSjtDQUFOOztBQUVYLFNBQVMsR0FBVCxDQUFjLEdBQWQsRUFBeUM7TUFBdEIsNERBQU0sa0JBQWdCO01BQVosNkRBQU8sbUJBQUs7O0FBQ3ZDLE1BQU0sTUFBTSx5QkFBVSxHQUFWLEVBQWUsTUFBZixDQUQyQjs7QUFHdkMsU0FBTyxNQUFNLEdBQU4sR0FBWSxNQUFNLElBQUssS0FBSixDQUFVLE1BQU0sR0FBTixHQUFZLENBQVosQ0FBWCxDQUEyQixJQUEzQixDQUFnQyxJQUFoQyxDQUFOLEdBQThDLEdBQTFELENBSGdDO0NBQXpDOztB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RTtBQW9DdkUsTUFBSSxLQUFKLEVBQVcsU0FBWCxFQXBDdUU7QUFxQ3ZFLFNBQU8sSUFBUCxDQUFZLFVBQVosRUFBd0IsT0FBeEIsQ0FBZ0MsVUFBQyxLQUFELEVBQVc7QUFDekMsUUFBTSxVQUFVLFdBQVcsS0FBWCxDQUFWOzs7O0FBRG1DLE9BS3pDLENBQ0UsS0FBSyxLQUFMLENBREYsRUFFRSxPQUFPLElBQVAsQ0FBWSxPQUFaLEVBQXFCLEdBQXJCLENBQXlCLFVBQUMsTUFBRDthQUFZLFFBQVEsTUFBUixJQUFrQixRQUFRLE1BQVIsQ0FBbEIsR0FBb0MsT0FBTyxNQUFQLENBQXBDO0tBQVosQ0FBekIsQ0FBeUYsSUFBekYsQ0FBOEYsSUFBOUYsQ0FGRixFQUx5QztHQUFYLENBQWhDLENBckN1RTtDQUF6RSIsImZpbGUiOiJvdXRwdXQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCdcblxuaW1wb3J0IGNoYWxrIGZyb20gJ2NoYWxrJ1xuaW1wb3J0IHN0cmlwQW5zaSBmcm9tICdzdHJpcC1hbnNpJ1xuaW1wb3J0IHtcbiAgQ0FURUdPUllfSU5GTyxcbiAgTVNHX0xFVkVMX0RFQlVHLFxuICBNU0dfTEVWRUxfRVJST1IsXG4gIE1TR19MRVZFTF9JTkZPLFxuICBNU0dfTEVWRUxfT0ssXG4gIE1TR19MRVZFTF9XQVJOLFxuICBNU0dfTEVWRUxfUkFXXG59IGZyb20gJ2hhbmRvdXQtY29uc3RhbnRzJ1xuXG5leHBvcnQgY29uc3Qgb3V0cHV0U3R5bGVzID0ge1xuICBoZWFkbGluZTogY2hhbGsuYm9sZC55ZWxsb3csXG4gIHVybDogY2hhbGsueWVsbG93LFxuICB0YXJnZXQ6IGNoYWxrLmN5YW4sXG4gIGVycm9yOiBjaGFsay5ib2xkLnJlZCxcbiAgdXNlcm5hbWU6IGNoYWxrLnllbGxvdyxcbiAgYXBwOiBjaGFsay55ZWxsb3csXG4gIHVzYWdlOiBjaGFsay5ib2xkLnllbGxvdyxcbiAgY2xpQXJnOiBjaGFsay5jeWFuLFxuICBbTVNHX0xFVkVMX0VSUk9SXTogY2hhbGsuYm9sZC5yZWQsXG4gIFtNU0dfTEVWRUxfSU5GT106IGNoYWxrLmJvbGQuZ3JleSxcbiAgW01TR19MRVZFTF9PS106IGNoYWxrLmJvbGQuZ3JlZW4sXG4gIFtNU0dfTEVWRUxfREVCVUddOiBjaGFsay5iZ1llbGxvdyxcbiAgW01TR19MRVZFTF9XQVJOXTogY2hhbGsuYmdSZWRcbn1cblxuLy8gVXRpbGl0eSBzdHVmZlxuY29uc3QgcmF3ID0gbXNnID0+IG91dHB1dChtc2csIE1TR19MRVZFTF9SQVcpXG5jb25zdCBuZXdsaW5lID0gKCkgPT4gcmF3KCcnKVxuY29uc3QgaHIgPSAoKSA9PiByYXcoY2hhbGsuZ3JleShuZXcgQXJyYXkoODApLmpvaW4oJy0nKSkpXG5cbmZ1bmN0aW9uIHBhZCAoc3RyLCBtYXggPSAxNSwgY2hhciA9ICcgJykge1xuICBjb25zdCBsZW4gPSBzdHJpcEFuc2koc3RyKS5sZW5ndGhcblxuICByZXR1cm4gbGVuIDwgbWF4ID8gc3RyICsgKG5ldyBBcnJheShtYXggLSBsZW4gKyAxKSkuam9pbihjaGFyKSA6IHN0clxufVxuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBvdXRwdXQgKG1lc3NhZ2UsIGxldmVsID0gTVNHX0xFVkVMX0lORk8sIGZyb21SZW1vdGUgPSBmYWxzZSkge1xuICBsZXQgcHJlcGVuZCA9ICcnXG5cbiAgaWYgKGxldmVsICE9PSBNU0dfTEVWRUxfUkFXKSB7XG4gICAgcHJlcGVuZCArPSBgWyR7ZnJvbVJlbW90ZSA/ICdzZXJ2ZXInIDogJ2xvY2FsJ306JHtvdXRwdXRTdHlsZXNbbGV2ZWxdKGxldmVsKX1dYFxuXG4gICAgY29uc29sZS5sb2coYCR7cGFkKHByZXBlbmQpfSAke21lc3NhZ2V9YClcbiAgfSBlbHNlIHtcbiAgICBjb25zb2xlLmxvZyhtZXNzYWdlKVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBvdXRwdXRUaXRsZSAoeyB2ZXJzaW9uIH0pIHsgLy8gQWxsIG9mIHBhY2thZ2UuanNvbiBwYXNzZWQgaW4sIHVzaW5nIG9ubHkgdmVyc2lvbiBmb3Igbm93XG4gIG5ld2xpbmUoKVxuICBocigpXG4gIHJhdyhvdXRwdXRTdHlsZXMuaGVhZGxpbmUoJ2hhbmRvdXQnKSlcbiAgcmF3KGAke291dHB1dFN0eWxlcy5oZWFkbGluZSgndGFpbG9yZWQgYXBwcycpfSBiYWNrZW5kIGRlcGxveW1lbnQgdG9vbCB2JHt2ZXJzaW9ufWApXG4gIGhyKClcbiAgbmV3bGluZSgpXG59XG5cbi8qKlxuICogUHJvY2Vzc2VzIHJhdyBkYXRhIGFuZCBnZW5lcmF0ZXMgb3V0cHV0IGZvciBzZXJ2ZXIgcmVzcG9uc2VzIHRoYXQgcmVxdWlyZSBhZGRpdGlvbmFsIHByb2Nlc3NpbmcgKGkuZS4gdGhvc2Ugd2l0aCBNU0dfTEVWRUxfUFJPQ0VTUykuXG4gKlxuICogQHBhcmFtIHdyYXBwZXJPYmogb2JqZWN0XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBwcm9jZXNzUmVzcG9uc2UgKHsgY2F0ZWdvcnksIGRhdGEgfSkge1xuICAvLyBXZSBvbmx5IGltcGxlbWVudCBDQVRFR09SWV9JTkZPIGZvciBub3csIGNhbiB1c2UgYSBzd2l0Y2ggb3IgYSBmdW5jdGlvbiBtYXAgbGF0ZXJcbiAgaWYgKGNhdGVnb3J5ID09PSBDQVRFR09SWV9JTkZPKSB7XG4gICAgcHJvY2Vzc0luZm9SZXNwb25zZShkYXRhKVxuICB9IGVsc2Uge1xuICAgIG91dHB1dChgSW5jb3JyZWN0IG91dHB1dCBwcm9jZXNzaW5nIGNhdGVnb3J5IFwiJHtjYXRlZ29yeX1cIiByZXR1cm5lZCBmcm9tIHNlcnZlci5gLCBNU0dfTEVWRUxfRVJST1IpXG4gIH1cbn1cblxuZnVuY3Rpb24gcHJvY2Vzc0luZm9SZXNwb25zZSAoeyBob3N0cywgZGVwbG95bWVudCwgdXNlcnMsIHBlcm1pc3Npb25zIH0pIHtcbiAgY29uc3QgeyBoZWFkbGluZSB9ID0gb3V0cHV0U3R5bGVzXG5cbiAgY29uc3QgaXRlbSA9IGNoYWxrLmJsdWVcbiAgY29uc3QgZ3JhbnRlZCA9IGNoYWxrLmdyZWVuXG4gIGNvbnN0IGRlbmllZCA9IGNoYWxrLnJlZFxuXG4gIGNvbnN0IGluZGVudCA9IChzdHIpID0+IHJhdyhgICAgICR7c3RyfWApXG4gIGNvbnN0IGNvbCA9IChsZWZ0LCByaWdodCA9ICcnLCB3aWR0aCA9IDI1KSA9PiBpbmRlbnQoYCR7cGFkKGxlZnQsIHdpZHRoKX0ke3JpZ2h0fWApXG4gIGNvbnN0IHRpdGxlID0gc3RyID0+IHtcbiAgICBocigpXG4gICAgaW5kZW50KGhlYWRsaW5lKHN0ci50b1VwcGVyQ2FzZSgpKSlcbiAgICBocigpXG4gIH1cblxuICBpZiAodXNlcnMpIHtcbiAgICB0aXRsZSgnVXNlcnMnKVxuICAgIHVzZXJzLmZvckVhY2godSA9PiBjb2woaXRlbSh1KSkpXG4gIH1cblxuICB0aXRsZSgnUGVybWlzc2lvbnMnKVxuICBPYmplY3Qua2V5cyhwZXJtaXNzaW9ucykuZm9yRWFjaCgocCkgPT4ge1xuICAgIGNvbChpdGVtKHApLCBwZXJtaXNzaW9uc1twXSA/IGdyYW50ZWQoJ2dyYW50ZWQnKSA6IGRlbmllZCgnZGVuaWVkJykpXG4gIH0pXG5cbiAgdGl0bGUoJ1RhcmdldHMnKVxuICBjb2woJ1RBUkdFVCBJRCcsICdIT1NUTkFNRScpXG4gIE9iamVjdC5rZXlzKGhvc3RzKS5mb3JFYWNoKChob3N0SWQpID0+IHtcbiAgICBjb25zdCBob3N0ID0gaG9zdHNbaG9zdElkXVxuICAgIGNvbnN0IGlzR3JvdXAgPSBBcnJheS5pc0FycmF5KGhvc3QpXG4gICAgY29uc3QgaWRPdXRwdXQgPSAoaXNHcm91cCA/ICdncm91cDogJyA6ICcnKSArIGl0ZW0oaG9zdElkKVxuXG4gICAgY29sKGlkT3V0cHV0LCBpc0dyb3VwID8gaG9zdC5qb2luKCcsICcpIDogaG9zdClcbiAgfSlcblxuICB0aXRsZSgnRGVwbG95bWVudCcpXG4gIGNvbCgnQVBQJywgJ1RBUkdFVFMnKVxuICBPYmplY3Qua2V5cyhkZXBsb3ltZW50KS5mb3JFYWNoKChhcHBJZCkgPT4ge1xuICAgIGNvbnN0IHRhcmdldHMgPSBkZXBsb3ltZW50W2FwcElkXVxuXG4gICAgLy8gRWFjaCBhcHBsaWNhYmxlIGRlcGxveW1lbnQgdGFyZ2V0IGZvciB0aGUgY3VycmVudCBhcHAgd2lsbCBiZSBhIHByb3BlcnR5IG9mIHRoZSBcInRhcmdldHNcIiBvYmplY3QsIGFuZCB0aGVcbiAgICAvLyBwcm9wZXJ0eSdzIHZhbHVlIHdpbGwgYmUgYSBib29sZWFuICh0cnVlIHdoZW4gZGVwbG95bWVudCBwZXJtaXNzaW9uIGhhcyBiZWVuIGdyYW50ZWQsIGZhbHNlIG90aGVyd2lzZSlcbiAgICBjb2woXG4gICAgICBpdGVtKGFwcElkKSxcbiAgICAgIE9iamVjdC5rZXlzKHRhcmdldHMpLm1hcCgodGFyZ2V0KSA9PiB0YXJnZXRzW3RhcmdldF0gPyBncmFudGVkKHRhcmdldCkgOiBkZW5pZWQodGFyZ2V0KSkuam9pbignLCAnKVxuICAgIClcbiAgfSlcbn1cbiJdfQ==